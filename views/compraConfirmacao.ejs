<!-- página de confirmação de compra (rota: /pagamento/compraConfirmacao) -->
<!DOCTYPE html>
<html lang="pt-BR">
 <head>
    <meta charset="UTF-8">
    <title>Compra Confirmada</title>
    <link rel="stylesheet" href="/stylesheets/pagamento.css">
    <link rel="stylesheet" href="/stylesheets/index.css">
    <link rel="stylesheet" href="/stylesheets/theme.css">
    <link rel="stylesheet" href="/stylesheets/menu-superior.css">
    <link rel="stylesheet" href="/stylesheets/footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/comprar-confirmacao.css">
    <script src="https://kit.fontawesome.com/a2d04c1f7a.js" crossorigin="anonymous"></script>
</head>
  <body class="compra-confirmacao d-flex flex-column min-vh-100">
    <%- include('partials/navbar') %>

    <main class="flex-fill">
      <div class="confirmation-wrapper">
        <div class="confirmation-card">
          <div class="confirmation-head mb-3">
            <div class="confirm-icon">
              <i class="fa fa-check-circle text-success" aria-hidden="true"></i>
            </div>
            <div class="confirm-text">
              <h1 class="h5 mb-0">Pagamento Recebido!</h1>
            </div>
          </div>

          <div class="confirmation-body">
            <div class="confirmation-text flex-fill">
              <p class="mb-2">
                Obrigado pela sua compra! Seu pedido foi confirmado com sucesso.
              </p>
              <p class="text-muted">
                Um e-mail de confirmação foi enviado com os detalhes do seu pedido.
              </p>

              <!-- ✅ MOSTRA ITENS COMPRADOS -->
              <% if (Array.isArray(itens) && itens.length) { %>
                <div class="items-list mb-3 mt-4">
                  <h6 class="mb-3">Itens do pedido:</h6>
                  <% itens.forEach(function(it){ %>
                    <div class="d-flex align-items-center item-row mb-3 p-2" style="border:1px solid #eee;border-radius:6px">
                      <!-- Imagem -->
                      <% if (it.imagem && /^https?:\/\//.test(it.imagem) === false) { %>
                        <img src="<%= it.imagem %>" class="item-thumb me-3 rounded" alt="<%= it.nome %>" style="width:80px;height:80px;object-fit:cover;border:1px solid #ddd">
                      <% } else if (it.imagem && /^https?:\/\//.test(it.imagem)) { %>
                        <img src="<%= it.imagem %>" class="item-thumb me-3 rounded" alt="<%= it.nome %>" style="width:80px;height:80px;object-fit:cover;border:1px solid #ddd">
                      <% } else { %>
                        <div style="width:80px;height:80px;background:#f3f4f6;border-radius:6px;margin-right:15px;display:flex;align-items:center;justify-content:center;border:1px solid #ddd">
                          <i class="fa fa-box" style="font-size:24px;color:#9ca3af"></i>
                        </div>
                      <% } %>
                      
                      <!-- Dados do item -->
                      <div class="flex-fill">
                        <div class="fw-bold" style="font-size:15px;color:#111"><%= it.nome %></div>
                        <div class="small text-muted">
                          Quantidade: <strong><%= it.quantidade %></strong>
                        </div>
                        <div class="small text-muted">
                          Valor unitário: 
                          <% if (it.precoOriginal) { %>
                            <span style="text-decoration:line-through;color:#999;margin-right:8px">R$ <%= Number(it.precoOriginal).toLocaleString('pt-BR', {minimumFractionDigits:2}) %></span>
                            <strong style="color:#28a745">R$ <%= Number(it.precoUnitario).toLocaleString('pt-BR', {minimumFractionDigits:2}) %></strong>
                          <% } else { %>
                            <strong>R$ <%= Number(it.precoUnitario).toLocaleString('pt-BR', {minimumFractionDigits:2}) %></strong>
                          <% } %>
                        </div>
                      </div>

                      <!-- Total do item -->
                      <div style="text-align:right;min-width:120px">
                        <div style="font-size:13px;color:#6b7280">Subtotal</div>
                        <div style="font-size:18px;color:#0b5ed7;font-weight:700">
                          R$ <%= Number(it.lineTotal).toLocaleString('pt-BR', {minimumFractionDigits:2}) %>
                        </div>
                      </div>
                    </div>
                  <% }) %>

                  <!-- Total geral -->
                  <div class="mt-3 p-3" style="background:#f8f9fa;border-radius:6px;border-left:4px solid #0b5ed7">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                      <div style="font-size:16px;font-weight:600;color:#111">Valor total do pedido:</div>
                      <div style="font-size:24px;font-weight:800;color:#0b5ed7">
                        R$ <%= Number(valor).toLocaleString('pt-BR', {minimumFractionDigits:2}) %>
                      </div>
                    </div>
                  </div>
                </div>
              <% } else { %>
                <div class="alert alert-info mt-3">
                  <i class="fa fa-info-circle me-2"></i>
                  Nenhum item foi encontrado neste pedido.
                </div>
              <% } %>

              <div class="confirmation-note text-muted small mt-4">
                Acompanhe o status do seu pedido na seção "Meus Pedidos".
              </div>
            </div>
          </div>

          <div class="confirmation-actions mt-4 text-center">
            <a href="/" class="btn btn-primary me-2">
              <i class="fa fa-home me-2"></i>Voltar à loja
            </a>
            <a href="/perfil" class="btn btn-outline-secondary">
              <i class="fa fa-user me-2"></i>Meus Pedidos
            </a>
          </div>
        </div>
      </div>
    </main>

    <%- include('partials/footer') %>
  </body>
</html>